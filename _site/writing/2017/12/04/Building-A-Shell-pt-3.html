<html>
  <head>
  <meta charset="utf-8">
  <meta lang="en">
  <link href="/static/css/custom.css" rel="stylesheet">
  <title>Doug Skinner</title>
  <link rel="shortcut icon" href="/img/favicon.ico" />

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="/static/js/custom.js"></script>

  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-97386400-1', 'auto');
      ga('send', 'pageview');
  </script>
</head>

  <body>
    <nav class="navigation">
  <h2>
    <a href="/index.html">Doug Skinner</a>
  </h2>
  <ul>
    <li>
      <a href="/">Home</a>
    </li>
    <li>
      <a href="/about.html">About</a>
    </li>
    <li>
      <a href="/photos.html">Photos</a>
    </li>
    <li>
      <a href="/projects.html">Projects</a>
    </li>
    <li>
      <a href="/writings.html">Writings</a>
    </li>
  </ul>
  <hr />
</nav>

    <div class="blog_post">
      <h4><a href="">Building a Shell, Part 3</a></h4>
      <hr />
      <p><p>Next, we’ll add a few built in functions to the shell. Our shell will support
printing the current directory, changing the current directory, and quitting as
built in commands. We’ll also be giving the shell the ability to run some
external commands in the next section of this series. The code for each of these
commands is simple, and the quit command was already included last time. So, the
code for printing the current directory:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>int wd(void) {
    char *current_dir;
    allocateStr(&amp;current_dir);
    GUARD_PTR(getcwd(current_dir, MAX_STR));
    puts(current_dir);
    return 0;
}
</code></pre></div></div>

<p>And the code for changing the directory:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>int chwd(char *new_path) {
    if (new_path == NULL) {
        printf("The proper usage of %s is %s.\n", "chwd", "chwd pathname");
    } else {
        GUARD(chdir(new_path));
    }
    return 0;
}
</code></pre></div></div>

<p>The functions will then be added to the shell like so:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>int main(void) {
    int _continue = 0;
    char *buff = malloc(sizeof(char) * 512);

    do {
        printf("[Command prompt]$ ");
        buff = getLine(stdin); // uses the getLine from yesterdays post.

        char *token;
        token = strtok(buff, " \n");

        if (strcmp(token, "quit") == 0) {
            _continue = -1;
        } else if (strcmp(token, "wd") == 0) {
            wd();
        } else if (strcmp(token, "chwd") == 0) {
            char *new_path;
            new_path = strtok(NULL, " \n");
            chwd(new_path);
        } else {
            pid_t child, wait;
            int child_status;

            child = fork();

            if (child == 0) {
                puts(buff);
                return 1;
            } else {
                do {
                    wait = waitpid(child, &amp;child_status, WUNTRACED);
                } while (!WIFEXITED(child_status) &amp;&amp; !WIFSIGNALED(child_status));
            }
        }
        free(buff);
    } while (_continue &gt;= 0);

    return 0;
}
</code></pre></div></div>

<p>These functions give our shell the beginning of usefullness, and will be
expanded upon tomorrow.</p>
</p>
      <h5><a href="/writings.html">Archives</a></h5>
    </div>
  </body>
</html>
