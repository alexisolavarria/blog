<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">
  <!-- My Font -->
  <link href="https://fonts.googleapis.com/css?family=Work+Sans" rel="stylesheet">
  <!-- Your custom styles -->
  <link href="/static/css/custom.css" rel="stylesheet">

  <title>Doug Skinner</title>
  <link rel="shortcut icon" href="/img/favicon.ico" />

  <!-- SCRIPTS -->
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"></script>
  <!-- My custom javascript-->
  <script type="text/javascript" src="/static/js/custom.js"></script>

  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-97386400-1', 'auto');
      ga('send', 'pageview');
  </script>
</head>

  <body>
    <div class="d-md-none">
      <div class="">
  <nav class="navbar fixed-top navbar-light bg-white">
    <a class="navbar-brand" href="#">Doug Skinner</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#myNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>
  	<div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav ml-auto float-right">
        <li class="nav-item">
          <a class="nav-link" href="/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/about.html">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/photos.html">Photos</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/projects.html">Projects</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/writings.html">Writings</a>
        </li>
      </ul>
    </div>
  </nav>
</div>

    </div>
    <div class="container" style="padding-top:5em;">
      <div class="container">
        <div class="row">
          <div class="d-none d-md-block col-md-5 col-lg-3">
            <div class="hero card shadow">
  <div class="card-body">
    <div class="text-center" style="margin-top:3em;">
      <a href="/about.html">
        <img class="img-responsive shadow" style="height:200px;width:200px;border-radius:50%;" src="/img/photos/other/me.jpg">
      </a>
      <div class="content">
        <a href="/index.html"><h3>Doug Skinner<br><small><a href="mailto:me@doug-skinner.com">contact</a></small></h3></a>
        <ul class="list-unstyled">
          <li><a href="/projects.html"><h5>Programmer</h5></a></li>
          <hr />
          <li><a href="/photos.html"><h5>Photography Enthusiast</h5></a></li>
          <hr />
          <li><a href="/writings.html"><h5>Wannabe Blogger</h5></a></li>
        </ul>
      </div>
    </div>
  </div>
</div>

          </div>
          <div class="col-xs-12 col-md-7 col-lg-9">
            <div class="row">
              <div class="col-11 col-lg-10 mx-auto">
                <div class="card shadow">
                  <div class="card-body">
                    <a href="/writing/2017/12/08/Building-A-Shell-pt-7.html">
                      <h3 class="text-center card-title">Building a Shell, Part 7</h3>
                    </a>
                    <hr />
                    <p class="lead card-text"><p>Today we’re going to be adding the third and final (for now) of our more complex functions to our
shell, fileconverter. This command was specific to my class “Make a shell” assignment, but the
functionality can definitely be improved upon for other use cases as well. The file takes in a
regular text file and converts it to a binary file, or vice versa, and looks like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include "error.h"
#include "helper.h"
#include "input.h"
#include &lt;fcntl.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;

int main(int argc, char *argv[]) {
    if (argc != 3 &amp;&amp; argc != 4) {
        fprintf(stderr, "The fileconverter must be called as fileconverter flag infile [outfile]\n");
        return -1;
    }

    // Make sure the string is null terminated
    //argv[3][strlen(argv[3])-1] = 0;

    char *flag = argv[1];
    char *infile = argv[2];
    char *outfile = argv[3];

    if (strcmp(flag, "-t") == 0) {
        FILE *fp_in = fopen(infile, "r");
        FILE *fp_out = fopen(outfile, "wb");

        char *line;
        line = getLine(fp_in);

        while (strlen(line) &gt; 0) {

            char *firstname = malloc(sizeof(char) * 256);
            char *lastname = malloc(sizeof(char) * 256);
            int id = 0;
            float GPA = 0.0;

            sscanf(line, "%s %s %d %f", firstname, lastname, &amp;id, &amp;GPA);

            int first_len = strlen(firstname);
            int last_len = strlen(lastname);

            fwrite(&amp;first_len, sizeof(int), 1, fp_out);
            fwrite(firstname, sizeof(char), first_len, fp_out);
            fwrite(&amp;last_len, sizeof(int), 1, fp_out);
            fwrite(lastname, sizeof(char), last_len, fp_out);
            fwrite(&amp;id, sizeof(int), 1, fp_out);
            fwrite(&amp;GPA, sizeof(float), 1, fp_out);

            line = getLine(fp_in);
        }

        fclose(fp_in);
        fclose(fp_out);

    } else if (strcmp(flag, "-b") == 0) {
        FILE *fp_in = fopen(infile, "rb");
        FILE *fp_out = fopen(outfile, "w");

        while (1) {
            char *firstname = malloc(sizeof(char) * 256);
            char *lastname = malloc(sizeof(char) * 256);
            int id = 0;
            float GPA = 0.0;
            int first_len = 0;
            int last_len = 0;

            fread(&amp;first_len, sizeof(int), 1, fp_in);
            fread(firstname, sizeof(char), first_len, fp_in);
            fread(&amp;last_len, sizeof(int), 1, fp_in);
            fread(lastname, sizeof(char), last_len, fp_in);
            fread(&amp;id, sizeof(int), 1, fp_in);
            fread(&amp;GPA, sizeof(float), 1, fp_in);

            if (feof(fp_in) != 0) {
                break;
            }

            fprintf(fp_out, "%s %s %d %f\n", firstname, lastname, id, GPA);
        }

        fclose(fp_in);
        fclose(fp_out);
    }  else {
        fprintf(stderr, "that is not an allowed flag.");
        return -1;
    }

    return 0;
}


</code></pre></div></div>
<p>Adding this functionality is relatively simple following the example function
that we gave yesterday, and just consists of adding another string comparison to
see if if matches the <code class="highlighter-rouge">fileconverter</code> function. Then we just get the required
arguments, and pass it using <code class="highlighter-rouge">execl</code> again.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>int main(void) {
    int _continue = 0;
    char *buff = malloc(sizeof(char) * 512);

    do {
        printf("[Command prompt]$ ");
        buff = getLine(stdin); // uses the getLine from yesterdays post.

        char *token;
        token = strtok(buff, " \n");

        if (strcmp(token, "quit") == 0) {
            _continue = -1;
        } else if (strcmp(token, "wd") == 0) {
			wd();
		} else if (strcmp(token, "chwd") == 0) {
			char *new_path;
            new_path = strtok(NULL, " \n");
            chwd(new_path);
		} else {
            pid_t child, wait;
            int child_status;

            child = fork();

            if (child == 0) {
                if (strcmp(buff, "echo") == 0) {
                    execl("/bin/echo", "echo", "Hello World!", NULL);
                    return 1;
                } else if (strcmp(buff, "create") == 0) {
                      char *flag = strtok(NULL, " ");
                      char *op1 = strtok(NULL, " ");
                      char *op2  = strtok(NULL, " ");
                      execl("./create", "create", flag, op1, op2, NULL);
                      return -1;
                } else if (strcmp(buff, "list") == 0) {
                    char *flag = strtok(NULL, " ");
                    char *op1 = strtok(NULL, " ");
                    execl("./list", "list", flag, op1, NULL);
                    return -1;
                } else if (strcmp(buff, "fileconverter") == 0) {
                    char *flag = strtok(NULL, " ");
                    char *op1 = strtok(NULL, " ");
                    char *op2  = strtok(NULL, " ");
                    execl("./fileconverter", "fileconverter", flag, op1, op2, NULL);
                    return -1;
                } else {
                    printf("The command you entered does not exist.\n");
                    return 1;
                }
            } else {
                do {
                    wait = waitpid(child, &amp;child_status, WUNTRACED);
                } while (!WIFEXITED(child_status) &amp;&amp; !WIFSIGNALED(child_status));
            }
        }
        free(buff);
    } while (_continue &gt;= 0);

    return 0;
}
</code></pre></div></div>
</p>
                  </div>
                  <div class="card-footer">
                    <a class="btn btn-outline-primary" href="/writings.html"> Archives </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
